FROM debian:stable

# Update system
RUN apt update && apt upgrade -y

# Install ssh & apache2
RUN apt install openssh-server apache2 -y

# Configure ssh
RUN mkdir /root/.ssh && ssh-keygen -t rsa -N "" -f /root/.ssh/id_rsa
RUN cat /root/.ssh/id_rsa.pub > /root/.ssh/authorized_keys
RUN chmod -R 755 /root/

# Configure apache2
RUN echo '<Directory />' >> /etc/apache2/conf-available/security.conf \
    && echo '  Options Indexes MultiViews' >> /etc/apache2/conf-available/security.conf \
    && echo '  AllowOverride None' >> /etc/apache2/conf-available/security.conf \
    && echo '  Require all granted' >> /etc/apache2/conf-available/security.conf \
    && echo '</Directory>' >> /etc/apache2/conf-available/security.conf

RUN sed -i 's/DocumentRoot \/var\/www\/html/DocumentRoot \//g' /etc/apache2/sites-available/000-default.conf

# Set user & root flags
RUN mkdir /root/.flags/
RUN echo 'this_is_a_gift' > /root/.flags/user.txt
RUN echo 'gg_well_played' > /root/.flags/root.txt
RUN echo 'Look for the "user.txt" and "root.txt" flags.' > /root/info.txt

CMD service ssh start && service apache2 start && tail -f /dev/null


# Build
# docker build . -f gift.dockerfile -t gift

# Run
# docker run -dit --name gift --hostname gift gift
