//Autor: Franco Larrea

using System;
using Renci.SshNet;

[Serializable]
class ConexionSSH
{
    private string usuario;
    private string contrasena;
    private string hostname;

    public ConexionSSH()
    {
        usuario = "fmol";
        contrasena = "S3cure3P4ssw0rd2@2@";
        hostname = "52.142.216.158";
    }

    public ConexionSSH(string usuario, 
        string contrasena, string hostname)
    {
        this.usuario = usuario;
        this.contrasena = contrasena;
        this.hostname = hostname;
    }

    public string Hostname
    {
        get { return hostname; }
    }

    public string EjecutarComando(string comando)
    {
        string resultado = "";

        using (SshClient client = new SshClient(hostname, usuario, contrasena))
        {
            try
            {
                client.Connect();
                var output = client.RunCommand(comando);
                client.Disconnect();
                resultado = output.Result;
            }
            catch (Exception e)
            {
                Console.Error.WriteLine(e.Message);
            }
        }
        
        return resultado;
    }

    public void SubirArchivo(string origen, string destino)
    {
        using (ScpClient client = new ScpClient(hostname, usuario, contrasena))
        {
            client.Connect();

            using (Stream localFile = File.OpenRead(origen))
            {
                client.Upload(localFile, destino);
            }
        }
    }

    public void DescargarArchivo(string origen, string destino)
    {
        using (ScpClient client = new ScpClient(hostname, usuario, contrasena))
        {
            client.Connect();

            using (Stream localFile = File.Create(destino))
            {
                client.Download(origen, localFile);
            }
        }
    }
}
